<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Assinatura</title>

    <script>
        window.onload = function () {
            var largura = window.innerWidth - 16;
            var altura = window.innerHeight / 2;

            var cxAssinatura = document.getElementById("cxAssinatura");
            cxAssinatura.setAttribute("width", largura);
            cxAssinatura.setAttribute("height", altura);

            var context = cxAssinatura.getContext("2d");

            var desenhando = false;
            
            cxAssinatura.onmousedown = function (evt) {
                context.moveTo(evt.clientX, evt.clientY);
                desenhando = true;
            }

            cxAssinatura.onmouseup = function () {
                desenhando = false;
            }

            cxAssinatura.onmousemove = function (evt) {
                if (desenhando) {
                    context.lineTo(evt.clientX, evt.clientY);
                    context.stroke();
                }
            }

            cxAssinatura.addEventListener("touchstart", function (evt) {
                console.log('entrei');
                var touch = evt.touches[0];
                context.moveTo(touch.clientX, touch.clientY);
                desenhando = true;
            }, false);

            cxAssinatura.addEventListener("touchend", function (evt) {
                console.log('sai');
                var mouseEvent = new MouseEvent("mouseup", {});
                cxAssinatura.dispatchEvent(mouseEvent);
                desenhando = false;
            }, false);  
            
            cxAssinatura.addEventListener("touchmove", function (evt) {
                console.log('movendo');
                if (desenhando) {
                    var touch = evt.touches[0];
                    context.lineTo(touch.clientX, touch.clientY);
                    context.stroke();
                }
            }, false);
            
            const assinarBtn = document.getElementById("assinarBtn");

            assinarBtn.onclick = function (e) {
                var http = new XMLHttpRequest();

                var image = cxAssinatura.toDataURL()

                var params = "image=" + image; 

                http.open("POST", "save.php", true);
                http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

                http.onreadystatechange = function(data) {
                    if(http.readyState == 4 && http.status == 200) {
                        alert("Imagem salvada com sucesso");
                    }
                }

                http.send(params);
            }
            
            const limparBtn = document.getElementById("limparBtn");
            
            limparBtn.onclick = function (e) {
                
                context.clearRect(0, 0, cxAssinatura.width, cxAssinatura.height);
                
            }

        }


    </script>
</head>
<body>
    <canvas id="cxAssinatura" width="100%" style="background:beige"></canvas>
    <br />
    <button id="assinarBtn" type="button" style="height: 100px; width: 200px; font-size: 32px;">Assinar</button>
    &nbsp;
    <button id="limparBtn" type="button" style="height: 100px; width: 200px; font-size: 32px;">Limpar</button>
</body>
</html>